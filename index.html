<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="A simple multi-interval timer with visual progress bars">
<meta name="theme-color" content="#4CAF50">
<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
<meta name="apple-mobile-web-app-title" content="FloTimer" />
<link rel="manifest" href="/site.webmanifest" />
 <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
<title>Multi-Interval Timer</title>
<style>
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }

  body {
    font-family: 'Nunito', sans-serif;
    text-align: center;
    padding: 20px;
    min-height: 100vh;
    background-color: #f8f8f8;
    background-image: url('https://i.imgur.com/VhtsL9V.jpeg');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    background-attachment: fixed;
    display: flex;
    align-items: flex-start;
    justify-content: center;
  }

  .overlay {
    background-color: rgba(255,255,255,0.2);
    padding: 3vh 4vw;
    border-radius: 12px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    width: 90vw;
    max-width: 600px;
  }

  h1 {
    font-size: 1.5rem;
    margin-bottom: 20px;
    color: #333;
  }

  .inputs {
    display: flex;
    justify-content: center;
    gap: 3vw;
    margin-bottom: 2vh;
    flex-wrap: wrap;
  }

  .input-group {
    display: flex;
    flex-direction: column;
    gap: 5px;
  }

  label { 
    font-weight: bold; 
    font-size: clamp(14px, 2.5vw, 20px);
    color: #555;
  }
  
  input { 
    width: clamp(60px, 10vw, 90px); 
    text-align: center; 
    padding: 1vh 0.5vw; 
    border-radius: 6px; 
    border: 1px solid #bbb;
    font-size: clamp(14px, 2.5vw, 18px);
  }
    transition: border-color 0.3s;
  }

  input:focus {
    outline: none;
    border-color: #4CAF50;
  }

  .timerBarContainer { 
    width: 100%; 
    height: clamp(20px, 3vh, 40px); 
    background: #e0e0e0; 
    border-radius: 10px; 
    overflow: hidden; 
    margin: 1vh 0;
  }
  
  .timerBar { 
    height: 100%; 
    width: 100%; 
    background: #4CAF50; 
    transition: width 0.8s linear, background-color 0.4s linear;
    border-radius: 12px;
  }

  #status { 
    margin: 15px 0; 
    font-weight: 600; 
    font-size: clamp(16px, 3vw, 24px);
    color: #333;
    min-height: 30px;
  }

  .buttonGroup { 
    display: flex; 
    justify-content: center; 
    flex-wrap: wrap; 
    gap: 10px; 
    margin-top: 20px; 
  }
  
  button { 
    padding: 12px 24px; 
    border: none; 
    border-radius: 8px; 
    cursor: pointer; 
    font-weight: 600;
    font-size: clamp(14px, 2.5vw, 18px);
    transition: transform 0.2s, box-shadow 0.2s;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
  }

  button:active {
    transform: scale(0.95);
  }

  button:hover {
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  }
  
  #startBtn { 
    background-color: #4CAF50;
    color: #fff; 
  }
  
  #pauseBtn { 
    background-color: #FF9800;
    color: #fff; 
  }
  
  #resetBtn { 
    background-color: #f44336;
    color: #fff; 
  }

  #installPrompt {
    background-color: #2196F3;
    color: white;
    padding: 12px 24px;
    border-radius: 8px;
    margin-bottom: 20px;
    display: none;
    font-weight: 600;
    box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3);
  }

  #installPrompt button {
    background-color: white;
    color: #2196F3;
    margin-left: 10px;
    padding: 8px 16px;
  }

  @media(max-width: 480px){
    .overlay {
      padding: 20px;
    }

    h1 {
      font-size: 1.3rem;
    }

    .inputs { 
      flex-direction: column; 
      gap: 15px; 
    }
    
    input { 
      width: 100px; 
    }
    
    .timerBarContainer { 
      height: 20px; 
    }

    button {
      padding: 10px 20px;
      font-size: 0.95rem;
    }
  }

  @media (display-mode: standalone) {
    body {
      padding: 10px;
    }
  }
</style>
</head>
<body>

<div class="overlay">
  <div id="installPrompt">
    <span>Install app for offline use</span>
    <button id="installBtn">Install</button>
  </div>

  <h1>⏱️ Interval Timer</h1>

  <div class="inputs">
    <div class="input-group">
      <label for="intervalTime">Time (seconds)</label>
      <input type="number" id="intervalTime" value="30" min="1">
    </div>
    <div class="input-group">
      <label for="intervalCount">Intervals</label>
      <input type="number" id="intervalCount" value="3" min="1">
    </div>
  </div>

  <div id="barsContainer"></div>
  <div id="status">Ready</div>

  <div class="buttonGroup">
    <button id="startBtn">Start</button>
    <button id="pauseBtn">Pause</button>
    <button id="resetBtn">Reset</button>
  </div>
</div>

<script>
// Service Worker Registration
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('./service-worker.js')
      .then(registration => {
        console.log('Service Worker registered successfully:', registration.scope);
      })
      .catch(error => {
        console.warn('Service Worker registration failed:', error);
      });
  });
}

// PWA Install Prompt
let deferredPrompt;
const installPrompt = document.getElementById('installPrompt');
const installBtn = document.getElementById('installBtn');

window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
  installPrompt.style.display = 'block';
});

installBtn.addEventListener('click', async () => {
  if (deferredPrompt) {
    deferredPrompt.prompt();
    const { outcome } = await deferredPrompt.userChoice;
    console.log(`User response to install prompt: ${outcome}`);
    deferredPrompt = null;
    installPrompt.style.display = 'none';
  }
});

window.addEventListener('appinstalled', () => {
  console.log('PWA installed successfully');
  installPrompt.style.display = 'none';
});

// Timer Logic
let intervalTimeInput = document.getElementById('intervalTime');
let intervalCountInput = document.getElementById('intervalCount');
let barsContainer = document.getElementById('barsContainer');
let status = document.getElementById('status');

let totalIntervals, currentInterval, timeLeft, timer;
let isRunning = false;
let audioCtx = null;

function createBars(){
  barsContainer.innerHTML='';
  totalIntervals=parseInt(intervalCountInput.value);
  for(let i=0;i<totalIntervals;i++){
    const container=document.createElement('div');
    container.className='timerBarContainer';
    const bar=document.createElement('div');
    bar.className='timerBar';
    bar.id='bar'+i;
    container.appendChild(bar);
    barsContainer.appendChild(container);
  }
}

function playBeep(){
  if(!audioCtx) audioCtx=new (window.AudioContext||window.webkitAudioContext)();
  const oscillator=audioCtx.createOscillator();
  const gainNode=audioCtx.createGain();
  
  oscillator.type='sine';
  oscillator.frequency.setValueAtTime(440,audioCtx.currentTime);
  oscillator.connect(gainNode);
  gainNode.connect(audioCtx.destination);
  
  // Fade in and out for smoother sound
  gainNode.gain.setValueAtTime(0,audioCtx.currentTime);
  gainNode.gain.linearRampToValueAtTime(0.3,audioCtx.currentTime+0.05);
  gainNode.gain.linearRampToValueAtTime(0,audioCtx.currentTime+0.4);
  
  oscillator.start();
  oscillator.stop(audioCtx.currentTime+0.4);
}

function getBarColor(percent){
  if(percent>66) return '#4CAF50';
  if(percent>33) return '#FFD700';
  if(percent>25) return '#FFA500';
  return '#FF4500';
}

function startTimer(){
  if(!isRunning){
    totalIntervals=parseInt(intervalCountInput.value);
    currentInterval=currentInterval||0;
    isRunning=true;
    status.textContent=`Interval ${currentInterval+1} of ${totalIntervals}`;
    runCountdown();
  }
}

function runCountdown(){
  const intervalDuration = parseInt(intervalTimeInput.value);
  const startTime = Date.now();
  
  function updateBar() {
    if (!isRunning) return; // Stop if paused
    
    const now = Date.now();
    const totalElapsed = (now - startTime) / 1000;
    const smoothTimeLeft = Math.max(0, intervalDuration - totalElapsed);
    const percent = (smoothTimeLeft / intervalDuration) * 100;
    
    const currentBar = document.getElementById('bar' + currentInterval);
    currentBar.style.width = percent + '%';
    currentBar.style.backgroundColor = getBarColor(percent);
    
    // Update status with seconds remaining
    const secondsLeft = Math.ceil(smoothTimeLeft);
    status.textContent = `Interval ${currentInterval + 1} of ${totalIntervals} - ${secondsLeft}s`;
    
    // Check if we've truly hit 0
    if (smoothTimeLeft <= 0) {
      playBeep();
      currentBar.style.width = '0%';
      currentBar.style.backgroundColor = getBarColor(0);
      
      if (currentInterval < totalIntervals - 1) {
        // Add a small delay before starting next interval
        setTimeout(() => {
          if (isRunning) { // Check if still running after delay
            currentInterval++;
            timeLeft = intervalDuration;
            status.textContent = `Interval ${currentInterval + 1} of ${totalIntervals}`;
            runCountdown(); // Start new countdown with fresh timer
          }
        }, 650); // 500ms delay between intervals
      } else {
        isRunning = false;
        status.textContent = 'Done!';
      }
    } else {
      requestAnimationFrame(updateBar);
    }
  }
  
  requestAnimationFrame(updateBar);
}

function pauseTimer(){
  if(isRunning){
    isRunning=false;
    status.textContent+=' (Paused)';
  }
}

function resetTimer(){
  isRunning=false;
  currentInterval=0;
  createBars();
  status.textContent='Ready';
}

document.getElementById('startBtn').addEventListener('click',()=>{
  if(!audioCtx){
    audioCtx=new (window.AudioContext||window.webkitAudioContext)();
    const osc=audioCtx.createOscillator();
    osc.connect(audioCtx.destination);
    osc.start();
    osc.stop(audioCtx.currentTime);
  }
  startTimer();
});
document.getElementById('pauseBtn').addEventListener('click',pauseTimer);
document.getElementById('resetBtn').addEventListener('click',resetTimer);
intervalCountInput.addEventListener('change',createBars);
window.onload=createBars;
</script>

</body>

</html>
